/*!
 * Clusterize.js v0.18.0 - https://github.com/NeXTs/Clusterize.js
 * Copyright 2015-2018 Denis Lukov - MIT License
 */
!function(e){"use strict";function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e){return"[object Number]"===Object.prototype.toString.call(e)}function r(e){return e&&1===e.nodeType}var o=e.document,i=o.documentElement;if(o.addEventListener){var s="onwheel"in o?"wheel":"onmousewheel"in o?"mousewheel":"DOMMouseScroll",l=function(t){var n=0;return"deltaY"in t?n=t.deltaY:"wheelDelta"in t?n=-t.wheelDelta/120:"detail"in t&&(n=t.detail/3),Math.max(-1,Math.min(1,n))},a=function(e,t){var n=o.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),i.dispatchEvent(n)};o.addEventListener(s,function(e){var t=l(e);a("clusterize-wheel",{target:e.target,deltaY:t})},!1)}var u=function(e){return this.options=e,r(this.options.rows_in_block)||(this.options.rows_in_block=50),t(this.options.blocks_in_cluster)||(this.options.blocks_in_cluster=4),this.options.tag||(this.options.tag="div"),this.options.show_no_data_row=!1!==this.options.show_no_data_row,this.options.no_data_class||(this.options.no_data_class="clusterize-no-data"),this.options.no_data_text||(this.options.no_data_text="No data"),this.options.keep_parity=!0===this.options.keep_parity,r(this.options.scrollElem)?this.scrollElem=this.options.scrollElem:(this.scrollElem=o.querySelector(this.options.scrollId),this.scrollElem||(this.scrollElem=o.getElementById(this.options.scrollId))),r(this.options.contentElem)?this.contentElem=this.options.contentElem:(this.contentElem=o.querySelector(this.options.contentId),this.contentElem||(this.contentElem=o.getElementById(this.options.contentId))),this.scrollElem&&this.contentElem?(this.rows=t(this.options.rows)?this.options.rows:[],this.cache={},this.scrollTop=this.scrollElem.scrollTop,this.lastCluster=0,this.insertToDOM(t(this.options.rows)?this.options.rows:[],this.cache),this.scrollElem.addEventListener("scroll",this.scrollListener.bind(this)),void this.bindEvents()):(console.error("Clusterize: required elements not found"),!1)};u.prototype={bindEvents:function(){o.addEventListener("clusterize-wheel",function(e){if(e.detail){var t=e.detail.target,n=this.scrollElem;if(n===t||n.contains(t)){var r=n.scrollTop+100*e.detail.deltaY;n.scrollTop=r}}}.bind(this))},constructor:u,checkChanges:function(e,t,n){var r,o=n||this.scrollTop||0,i=t||!1,s=e||!1,l=this.options.cluster_height||100,a=l*this.options.blocks_in_cluster,u=Math.floor(o/(l*this.options.rows_in_block))*l*this.options.rows_in_block,c=u+a+l;if("number"!=typeof this.prevTopDiff||this.prevTopDiff===this.lastCluster){for(r=0;!i&&u+r<c+100&&r<a;r+=l)this.cache[u+r];i=r>=a}this.prevTopDiff=this.lastCluster,i&&(this.lastCluster!==u||s)&&(this.options.callbacks&&this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(Math.floor(o/(this.rows_in_cluster_height*this.cluster_height/100))),this.lastCluster=u,this.insertToDOM(this.rows,this.cache),this.options.callbacks&&this.options.callbacks.clusterChanged&&this.options.callbacks.clusterChanged())},refresh:function(e){(this.getRowsHeight(this.rows)||e)&&(this.update(this.rows),this.options.callbacks&&this.options.callbacks.clusterChanged&&this.options.callbacks.clusterChanged())},update:function(e){this.rows=t(e)?e:[],this.cache={},this.insertToDOM(this.rows,this.cache)},clear:function(){this.update([])},getRowsAmount:function(){return this.rows.length},getScrollProgress:function(){return this.lastCluster/(this.rows.length*this.options.item_height||1)*100},destroy:function(e){this.unbindEvents(),this.contentElem.innerHTML=e?this.generateEmptyRow():this.rows.join("")},unbindEvents:function(){this.scrollElem.removeEventListener("scroll",this.scrollListener)},scrollListener:function(){this.scrollTop=this.scrollElem.scrollTop,this.checkChanges()},insertToDOM:function(e,t){if(!e.length)return this.contentElem.innerHTML=this.generateEmptyRow();var n=this.options.cluster_height||100,r=this.options.rows_in_block,o=r*this.options.blocks_in_cluster,i=this.lastCluster,s=i+o,l=Math.max((e.length-o-i)*n,0),a={top_offset:Math.max(i*n,0),bottom_offset:l,rows_above:i,rows:Math.min(o,e.length)},u=e.slice(i,s).join(""),c=['<',this.options.tag,' class="clusterize-extra-row clusterize-top-space" style="height:',a.top_offset,'px;"></',this.options.tag,'>',u,'<',this.options.tag,' class="clusterize-extra-row clusterize-bottom-space" style="height:',a.bottom_offset,'px;"></',this.options.tag,">"].join("");n!==this.getRowsHeight(e)&&this.explicitRefresh&&this.refresh(!0),t.data!==c&&(this.options.callbacks&&this.options.callbacks.clusterWillChange&&this.options.callbacks.clusterWillChange(),this.contentElem.innerHTML=c,t.data=c,this.options.callbacks&&this.options.callbacks.clusterChanged&&this.options.callbacks.clusterChanged())},generateEmptyRow:function(){if(!this.options.show_no_data_row)return"";var e='<',t=' class="clusterize-extra-row ',n='"><',r=">",o="</";return this.options.tag+t+this.options.no_data_class+n+this.options.tag+r+this.options.no_data_text+o+this.options.tag+r+o+this.options.tag+r},getRowsHeight:function(){var e=this.options.item_height;return e!==this.options.cluster_height&&(this.options.cluster_height!==e&&(this.options.cluster_height=e),this.options.cluster_height=e),e}},"undefined"!=typeof module&&module.exports?module.exports=u:e.Clusterize=u}(window);
